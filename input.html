<!DOCTYPE html>
<html lang="ja">
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<title>アクティビティ入力</title>
		<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore-min.js"></script>
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
	
	<script>
	$(document).ready(function(){
		// 現在日付を取得
		var jnow = jQuery.now();
		var nowdate = new Date(jnow);
		var yyyymmdd = 		nowdate.getFullYear() 
						+ 	"/" + ("0" + (nowdate.getMonth()+1)).slice(-2) 
						+	"/" + ("0" + nowdate.getDate()).slice(-2);
		
		// 現在日付を設定
		var $aform = $('#actvform');
		$aform.find("[name=actvdate]").val(yyyymmdd);
		
		// 編集不可に設定
		$aform.find("[name=actvdate]").attr("readonly",true);

	});
	
	jQuery(function($){
		$("#actvform").submit(function(){
		
			// HTMLでの送信をキャンセル
			event.preventDefault();
		
			alert("入力内容を登録します");

			// 操作対象のフォーム要素を取得
			var $form = $(this);
			
			// 送信ボタンを取得
			// （後で使う: 二重送信を防止する。）
			var $btn = $form.find("[name=inputactv]");
			
			var $res = $form.find("[name=results]");
			
			// 送信
			$.ajax({
				// 送信先URL
				url: 'https://deboo.mybluemix.net/v1/activity',
				type: 'POST',
				data: $form.serialize(), 
				timeout: 10000,  // 単位はミリ秒
				// 送信前
				beforeSend: function(xhr, settings) {
					// ボタンを無効化し、二重送信を防止
					$btn.attr('disabled', true);
				},
				// 応答後
				complete: function(xhr, textStatus) {
					// ボタンを有効化し、再送信を許可
					$btn.attr('disabled', false);
				},
				
				// 通信成功時の処理
				success: function(result, textStatus, xhr) {
					// 入力値を初期化
					$form[0].reset();
					$res.val('OK');
				},
				
				// 通信失敗時の処理
				error: function(xhr, textStatus, error) {
					$res.val('NG');
				}
			});
			
		});
	});
	
	
	</script>
	
	</head>
	<body>
		<form class="form-horizontal" method="POST" id="actvform" name="actvform">
			<div class="form-group">
				<label for="bodyweight" class="col-sm-4 control-label">_id</label></label>
				<div class="col-sm-offset-4 col-sm-6">
					<input type="text" class="form-control" id="sysid" name="sysid" readonly="readonly">
				</div>
			</div>
			<div class="form-group">
				<label for="bodyweight" class="col-sm-4 control-label">ユーザーＩＤ</label></label>
				<div class="col-sm-offset-4 col-sm-6">
					<input type="text" class="form-control" id="userid" name="userid" readonly="readonly">
				</div>
			</div>
			<div class="form-group">
				<label for="actvDate" class="col-sm-4 control-label">日付</label>
				<div class="col-sm-6">
					<input type="text" class="form-control" id="actvdate" name="actvdate">
				</div>
			</div>
			<div class="form-group">
				<label for="bodyweight" class="col-sm-4 control-label">体重</label>
				<div class="col-sm-6">
					<input type="number" class="form-control" id="bodyweight" placeholder="Amount" name="bodyweight">
				</div>
			</div>
			<div class="form-group">
				<label for="fatrate" class="col-sm-4 control-label">体脂肪率</label>
				<div class="col-sm-6">
					<input type="number" class="form-control" id="fatrate" placeholder="Amount" name="fatrate">
				</div>
			</div>
			<div class="form-group">
				<label for="steps" class="col-sm-4 control-label">歩数</label>
				<div class="col-sm-6">
					<input type="number" class="form-control" id="steps" placeholder="Amount" name="steps2">
				</div>
			</div>
			<div class="form-group">
				<div class="col-sm-offset-4 col-sm-6">
				<button type="submit" class="btn btn-default" id="inputactv" name="inputactv">入力</button>
				</div>
			</div>
			<div class="form-group">
				<div class="col-sm-offset-4 col-sm-6">
				<input type="text" class="form-control" id="results" name="results" readonly="readonly">
				</div>
			</div>
		</form>
	</body>
</html>
