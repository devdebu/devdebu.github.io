<!DOCTYPE html>
<html lang="ja">
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<title>アクティビティ入力</title>
		<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore-min.js"></script>
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
	
	<script>
	$(document).ready(function(){
		// 現在日付を取得
		var jnow = jQuery.now();
		var nowdate = new Date(jnow);
		var yyyymmdd = 		nowdate.getFullYear() 
						+ 	"/" + ("0" + (nowdate.getMonth()+1)).slice(-2) 
						+	"/" + ("0" + nowdate.getDate()).slice(-2);
		
		// 現在日付を設定
		var $aform = $('#actvform');
		$aform.find("[name=date]").val(yyyymmdd);
		
		// 編集不可の設定
		$aform.find("[name=date]").attr("readonly",true);
		
		// ページ読み込み時にユーザーＩＤ取得
		var userId = "devdebu3";
		$aform.find("[name=userId]").val(userId);
		
		// サンプル値をランダムでセット
		$aform.find("[name=weight]").val(jnow%10+50);
		$aform.find("[name=fat]").val(jnow%5+19);
		$aform.find("[name=step]").val(jnow%30000);

	});
	
	jQuery(function($){
		$("#inputactv").on('click',function(){
		
			// HTMLでの送信をキャンセル
			//event.preventDefault();
		
			alert("入力内容を登録します");
			
			var userId = "";//localStorage.getItem("userId");

			// 操作対象のフォーム要素を取得
			var $form = $("#actvform");
			
			// 送信ボタンを取得
			var $res = $form.find("[name=results]");
			
			// 送信
			$.ajax({
				// 送信先URL
				url:'https://deboo.mybluemix.net/v1/activity',
				type: 'POST',
				data: $form.serialize(),
				//data:{_id:"f1ccb982723683c8f9e424f12800437c",userId: "f1ccb982723683c8f9e424f12800437c",date:"",fat:0,step:0,weight:0},
				timeout: 10000,  // 単位はミリ秒
				success: function(result, textStatus, xhr) {
					// 入力値を初期化
					$form[0].reset();
					$res.val('OK');
				},
				error: function(xhr, textStatus, error) {
					$res.val('NG');
				}
			});
			
		});
	});
	
	
	</script>
	
	</head>
	<body>
		<form class="form-horizontal" method="POST" id="actvform" name="actvform">
			<div class="form-group">
				<label for="bodyweight" class="col-sm-4 control-label">ユーザーＩＤ</label></label>
				<div class="col-sm-offset-4 col-sm-6">
					<input type="text" class="form-control" id="userId" name="userId" readonly="readonly">
				</div>
			</div>
			<div class="form-group">
				<label for="actvDate" class="col-sm-4 control-label">日付</label>
				<div class="col-sm-6">
					<input type="text" class="form-control" id="date" name="date">
				</div>
			</div>
			<div class="form-group">
				<label for="bodyweight" class="col-sm-4 control-label">体重</label>
				<div class="col-sm-6">
					<input type="number" class="form-control" id="weight" placeholder="Amount" name="weight">
				</div>
			</div>
			<div class="form-group">
				<label for="fatrate" class="col-sm-4 control-label">体脂肪率</label>
				<div class="col-sm-6">
					<input type="number" class="form-control" id="fat" placeholder="Amount" name="fat">
				</div>
			</div>
			<div class="form-group">
				<label for="steps" class="col-sm-4 control-label">歩数</label>
				<div class="col-sm-6">
					<input type="number" class="form-control" id="step" placeholder="Amount" name="step">
				</div>
			</div>
			<div class="form-group">
				<div class="col-sm-offset-4 col-sm-6">
				<button type="button" class="btn btn-default" id="inputactv" name="inputactv">入力</button>
				</div>
			</div>
			<div class="form-group">
				<div class="col-sm-offset-4 col-sm-6">
				<input type="text" class="form-control" id="results" name="results" readonly="readonly">
				</div>
			</div>
		</form>
	</body>
</html>
